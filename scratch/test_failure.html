
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="http://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="http://yihui.name/knitr"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.16</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(RosetteDetector)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: EBImage
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: reshape2
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: e1071
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(methods)</span>

<span class="hl std">img_file</span> <span class="hl kwb">&lt;-</span> <span class="hl std">base</span><span class="hl opt">::</span><span class="hl kwd">system.file</span><span class="hl std">(</span><span class="hl str">&quot;images&quot;</span><span class="hl std">,</span><span class="hl str">&quot;example1.jpeg&quot;</span><span class="hl std">,</span> <span class="hl kwc">package</span> <span class="hl std">=</span> <span class="hl str">&quot;RosetteDetector&quot;</span><span class="hl std">,</span> <span class="hl kwc">mustWork</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl com"># img_file &lt;- base::system.file(&quot;images&quot;,&quot;example2.jpeg&quot;, package = &quot;RosetteDetector&quot;, mustWork = TRUE)</span>
<span class="hl std">img</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">channel</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= EBImage</span><span class="hl opt">::</span><span class="hl kwd">readImage</span><span class="hl std">(img_file),</span><span class="hl kwc">mode</span> <span class="hl std">=</span> <span class="hl str">&quot;rgb&quot;</span><span class="hl std">)</span>

<span class="hl com"># This finds top left</span>
<span class="hl com"># res &lt;- find_sticker(img = img, mins = c(0.1,0.25,0.25), maxs = c(0.25,0.3,0.4), return.img = TRUE)</span>
<span class="hl com"># res</span>
<span class="hl com"># display(res$img)</span>


<span class="hl std">mins</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.1</span><span class="hl std">,</span><span class="hl num">0.25</span><span class="hl std">,</span><span class="hl num">0.25</span><span class="hl std">)</span>
<span class="hl std">maxs</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.25</span><span class="hl std">,</span><span class="hl num">0.3</span><span class="hl std">,</span><span class="hl num">0.4</span><span class="hl std">)</span>

<span class="hl std">selected</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span><span class="hl num">NA</span><span class="hl std">,</span><span class="hl num">NA</span><span class="hl std">)</span>
<span class="hl kwa">for</span><span class="hl std">(rgb.channel</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">){</span>
  <span class="hl std">rgb.channel</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span>
  <span class="hl com"># rgb.channel &lt;- 2</span>
  <span class="hl com"># rgb.channel &lt;- 3</span>

  <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Hola1\n&quot;</span><span class="hl std">)</span>
  <span class="hl std">mono.img</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">channel</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= img[,,rgb.channel],</span><span class="hl kwc">mode</span> <span class="hl std">=</span> <span class="hl str">&quot;gray&quot;</span><span class="hl std">)</span>
  <span class="hl com"># display(mono.img)</span>
  <span class="hl com"># display(mono.img &gt;= topleft.min[rgb.channel])</span>
  <span class="hl com"># display(mono.img &lt;= topleft.max[rgb.channel])</span>
  <span class="hl com"># </span>
  <span class="hl com"># display(mono.img &gt;= 0.3)</span>
  <span class="hl com"># display(mono.img &lt;= 0.5)</span>
  <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;Hola2\n&quot;</span><span class="hl std">)</span>
  <span class="hl std">selected[[rgb.channel]]</span> <span class="hl kwb">&lt;-</span> <span class="hl std">(mono.img</span> <span class="hl opt">&gt;=</span> <span class="hl std">mins[rgb.channel])</span> <span class="hl opt">&amp;</span> <span class="hl std">(mono.img</span> <span class="hl opt">&lt;=</span> <span class="hl std">maxs[rgb.channel])</span>
  <span class="hl com"># display(selected)</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## Hola1
## Hola2
## Hola1
## Hola2
## Hola1
## Hola2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Merge</span>
<span class="hl std">selected</span> <span class="hl kwb">&lt;-</span> <span class="hl std">selected[[</span><span class="hl num">1</span><span class="hl std">]]</span> <span class="hl opt">&amp;</span> <span class="hl std">selected[[</span><span class="hl num">2</span><span class="hl std">]]</span> <span class="hl opt">&amp;</span> <span class="hl std">selected[[</span><span class="hl num">3</span><span class="hl std">]]</span>
<span class="hl com"># display(selected)</span>

<span class="hl com"># Segment and pick biggest</span>
<span class="hl std">selected</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">bwlabel</span><span class="hl std">(selected)</span>
<span class="hl std">sizes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">table</span><span class="hl std">(selected)</span>
<span class="hl std">sizes</span> <span class="hl kwb">&lt;-</span> <span class="hl std">sizes[</span> <span class="hl opt">-</span><span class="hl kwd">which</span><span class="hl std">(</span><span class="hl kwd">names</span><span class="hl std">(sizes)</span> <span class="hl opt">==</span> <span class="hl str">&quot;0&quot;</span><span class="hl std">) ]</span>
<span class="hl std">sizes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sort</span><span class="hl std">(sizes,</span> <span class="hl kwc">decreasing</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">spot</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">names</span><span class="hl std">(sizes[</span><span class="hl num">1</span><span class="hl std">]))</span>
<span class="hl std">selected[ selected</span> <span class="hl opt">!=</span> <span class="hl std">spot ]</span> <span class="hl kwb">&lt;-</span> <span class="hl num">0</span>
<span class="hl std">selected</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">fillHull</span><span class="hl std">(selected)</span>
<span class="hl std">selected</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">bwlabel</span><span class="hl std">(selected)</span>
<span class="hl com"># table(selected)</span>
<span class="hl com"># display(selected)</span>

<span class="hl std">pos</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">computeFeatures.moment</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= selected)[</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;m.cx&quot;</span><span class="hl std">,</span><span class="hl str">&quot;m.cy&quot;</span><span class="hl std">)]</span>
<span class="hl std">size</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EBImage</span><span class="hl opt">::</span><span class="hl kwd">computeFeatures.shape</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= selected)[</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl str">&quot;s.area&quot;</span><span class="hl std">]</span>

<span class="hl std">res</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">(</span><span class="hl kwc">pos</span> <span class="hl std">= pos,</span> <span class="hl kwc">size</span> <span class="hl std">= size)</span>
<span class="hl std">res[[</span><span class="hl str">&quot;img&quot;</span><span class="hl std">]]</span> <span class="hl kwb">&lt;-</span> <span class="hl std">selected</span>
<span class="hl std">res</span>
</pre></div>
<div class="output"><pre class="knitr r">## $pos
##     m.cx     m.cy 
## 510.4048 319.2864 
## 
## $size
## [1] 533945
## 
## $img
## Image 
##   colorMode    : Grayscale 
##   storage.mode : integer 
##   dim          : 1042 648 
##   frames.total : 1 
##   frames.render: 1 
## 
## imageData(object)[1:5,1:6]
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    0    0    0    0
## [2,]    0    0    0    0    0    0
## [3,]    0    0    0    0    0    0
## [4,]    0    0    0    0    0    0
## [5,]    0    0    0    0    0    0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">display</span><span class="hl std">(res</span><span class="hl opt">$</span><span class="hl std">img)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/test-failure-Rhtmlauto-report-1.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># </span>
<span class="hl com"># # This finds top right</span>
<span class="hl com"># res &lt;- find_sticker(img = img, mins = c(0.1,0.0,0.1), maxs = c(0.2,0.15,0.3), return.img = TRUE)</span>
<span class="hl com"># res</span>
<span class="hl com"># display(res$img)</span>
<span class="hl com"># </span>
<span class="hl com"># # This finds bottom left</span>
<span class="hl com"># res &lt;- find_sticker(img = img, mins = c(0.2,0.1,0.1), maxs = c(0.4,0.2,0.2), return.img = TRUE)</span>
<span class="hl com"># res</span>
<span class="hl com"># display(res$img)</span>
</pre></div>
</div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.4.0 (2017-04-21)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 16.04.2 LTS
## 
## Matrix products: default
## BLAS: /usr/lib/libblas/libblas.so.3.6.0
## LAPACK: /usr/lib/lapack/liblapack.so.3.6.0
## 
## locale:
##  [1] LC_CTYPE=es_US.UTF-8       LC_NUMERIC=C               LC_TIME=es_US.UTF-8       
##  [4] LC_COLLATE=es_US.UTF-8     LC_MONETARY=es_US.UTF-8    LC_MESSAGES=es_US.UTF-8   
##  [7] LC_PAPER=es_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
## [10] LC_TELEPHONE=C             LC_MEASUREMENT=es_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] methods   stats     graphics  grDevices utils     datasets  base     
## 
## other attached packages:
## [1] RosetteDetector_0.0-3 e1071_1.6-8           reshape2_1.4.2       
## [4] EBImage_4.18.0        knitr_1.16           
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.11        locfit_1.5-9.1      lattice_0.20-35     class_7.3-14       
##  [5] fftwtools_0.9-8     png_0.1-7           plyr_1.8.4          tiff_0.1-5         
##  [9] grid_3.4.0          magrittr_1.5        evaluate_0.10.1     highr_0.6          
## [13] stringi_1.1.5       tools_3.4.0         stringr_1.2.0       jpeg_0.1-8         
## [17] abind_1.4-5         parallel_3.4.0      compiler_3.4.0      BiocGenerics_0.22.0
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2017-07-07 14:23:10 PDT&quot;
</pre></div>
</div></div>


</body>
</html>
